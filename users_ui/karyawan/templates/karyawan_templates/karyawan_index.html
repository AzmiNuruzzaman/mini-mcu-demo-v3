<!-- users_interface/karyawan/templates/karyawan/karyawan_index.html -->
{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">🏥 Medical Check-Up Result</h2>

    <style>
        .unwell { color: red; font-weight: bold; }
        table th, table td { vertical-align: middle !important; }
    </style>

    <!-- Profile -->
    <h4>👤 Profil Karyawan</h4>
    <ul class="list-group mb-3">
        <li class="list-group-item"><strong>Nama:</strong> {{ employee.nama }}</li>
        <li class="list-group-item"><strong>Tanggal Lahir:</strong> {{ employee.tanggal_lahir }}</li>
        <li class="list-group-item"><strong>Lokasi:</strong> {{ employee.lokasi }}</li>
        <li class="list-group-item"><strong>Jabatan:</strong> {{ employee.jabatan }}</li>
        <li class="list-group-item"><strong>Kontak Darurat:</strong> {{ employee.kontak_darurat|default:"-" }}</li>
    </ul>

    <!-- Latest Checkup -->
    {% if latest_checkup %}
    <h4>📊 Hasil Terbaru</h4>
    <div class="row mb-3">
        <div class="col-md-4">
            <p><strong>BMI:</strong> {{ latest_checkup.bmi }}</p>
            <p><strong>Berat:</strong> {{ latest_checkup.berat }} kg</p>
            <p><strong>Umur:</strong> {{ latest_checkup.umur }} tahun</p>
        </div>
        <div class="col-md-4">
            <p><strong>Tinggi:</strong> {{ latest_checkup.tinggi }} cm</p>
            <p><strong>Lingkar Perut:</strong> {{ latest_checkup.lingkar_perut }} cm</p>
        </div>
        <div class="col-md-4">
            <p><strong>Gula Darah Puasa:</strong> {{ latest_checkup.gula_darah_puasa }}</p>
            <p><strong>Gula Darah Sewaktu:</strong> {{ latest_checkup.gula_darah_sewaktu }}</p>
            <p><strong>Cholesterol:</strong> {{ latest_checkup.cholesterol }}</p>
            <p><strong>Asam Urat:</strong> {{ latest_checkup.asam_urat }}</p>
        </div>
    </div>
    {% else %}
        <p class="text-muted">Belum ada data medical check-up tersedia.</p>
    {% endif %}

    <!-- Full History -->
    <h4>📜 Riwayat Pemeriksaan</h4>
    {% if history_checkup %}
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead>
            <tr>
                {% for key in history_checkup.0.keys %}
                    <th>{{ key|capfirst }}</th>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
            {% for row in history_checkup %}
                <tr>
                    {% for key, value in row.items %}
                        {% if key in "gula_darah_puasa,gula_darah_sewaktu,cholesterol,asam_urat,bmi,lingkar_perut" and value and ((key=='gula_darah_puasa' and value>120) or (key=='gula_darah_sewaktu' and value>200) or (key=='cholesterol' and value>240) or (key=='asam_urat' and value>7) or (key=='bmi' and value>=30) or (key=='lingkar_perut' and value>90)) %}
                            <td class="unwell">{{ value }}</td>
                        {% else %}
                            <td>{{ value }}</td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <p class="text-muted">Belum ada data pemeriksaan medis.</p>
    {% endif %}

    <hr>
    <p class="text-info">ℹ️ Hubungi tenaga kesehatan jika ada pertanyaan mengenai hasil medical check-up Anda.</p>
</div>
{% endblock %}
